<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Uncertainty â€¢ qss</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">qss</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/causality.html">Causality</a>
    </li>
    <li>
      <a href="../articles/discovery.html">Discovery</a>
    </li>
    <li>
      <a href="../articles/intro.html">Intro</a>
    </li>
    <li>
      <a href="../articles/measurement.html">Measurement</a>
    </li>
    <li>
      <a href="../articles/prediction.html">Prediction</a>
    </li>
    <li>
      <a href="../articles/probability.html">Probability</a>
    </li>
    <li>
      <a href="../articles/uncertainty.html">Uncertainty</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Uncertainty</h1>
            
          </div>

    
    
<div class="contents">
<div id="chapter-7-uncertainty" class="section level1">
<h1 class="hasAnchor">
<a href="#chapter-7-uncertainty" class="anchor"></a>Chapter 7: Uncertainty</h1>
<div id="section-7-1-estimation" class="section level2">
<h2 class="hasAnchor">
<a href="#section-7-1-estimation" class="anchor"></a>Section 7.1: Estimation</h2>
<div id="section-7-1-1-unbiasedness-and-consistency" class="section level3">
<h3 class="hasAnchor">
<a href="#section-7-1-1-unbiasedness-and-consistency" class="anchor"></a>Section 7.1.1: Unbiasedness and Consistency</h3>
<pre class="sourceCode r"><code class="sourceCode r">## simulation parameters
n &lt;-<span class="st"> </span><span class="dv">100</span> <span class="co"># sample size</span>
mu0 &lt;-<span class="st"> </span><span class="dv">0</span> <span class="co"># mean of Y_i(0)</span>
sd0 &lt;-<span class="st"> </span><span class="dv">1</span> <span class="co"># standard deviation of Y_i(0)</span>
mu1 &lt;-<span class="st"> </span><span class="dv">1</span> <span class="co"># mean of Y_i(1)</span>
sd1 &lt;-<span class="st"> </span><span class="dv">1</span> <span class="co"># standard deviation of Y_i(1)</span>

## generate a sample
Y0 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean =</span> mu0, <span class="dt">sd =</span> sd0)
Y1 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean =</span> mu1, <span class="dt">sd =</span> sd1)
tau &lt;-<span class="st"> </span>Y1 -<span class="st"> </span>Y0 <span class="co"># individual treatment effect</span>
## true value of the sample average treatment effect
SATE &lt;-<span class="st"> </span><span class="kw">mean</span>(tau)
SATE</code></pre>
<pre><code>## [1] 0.7910608</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## repeatedly conduct randomized controlled trials
sims &lt;-<span class="st"> </span><span class="dv">5000</span> <span class="co"># repeat 5,000 times, we could do more</span>
diff.means &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, sims)  <span class="co"># container</span>

for (i in <span class="dv">1</span>:sims) {
    ## randomize the treatment by sampling of a vector of 0's and 1's
    treat &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">1</span>, n /<span class="st"> </span><span class="dv">2</span>), <span class="kw">rep</span>(<span class="dv">0</span>, n /<span class="st"> </span><span class="dv">2</span>)), <span class="dt">size =</span> n, <span class="dt">replace =</span> <span class="ot">FALSE</span>)
    ## difference-in-means
    diff.means[i] &lt;-<span class="st"> </span><span class="kw">mean</span>(Y1[treat ==<span class="st"> </span><span class="dv">1</span>]) -<span class="st"> </span><span class="kw">mean</span>(Y0[treat ==<span class="st"> </span><span class="dv">0</span>])
}

## estimation error for SATE
est.error &lt;-<span class="st"> </span>diff.means -<span class="st"> </span>SATE
<span class="kw">summary</span>(est.error)</code></pre>
<pre><code>##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
## -0.542364 -0.104843  0.005036  0.002633  0.114995  0.569677</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## PATE simulation
PATE &lt;-<span class="st"> </span>mu1 -<span class="st"> </span>mu0
diff.means &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, sims)
for (i in <span class="dv">1</span>:sims) {
    ## generate a sample for each simulation: this used to be outside of loop
    Y0 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean =</span> mu0, <span class="dt">sd =</span> sd0)
    Y1 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean =</span> mu1, <span class="dt">sd =</span> sd1)
    treat &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">1</span>, n /<span class="st"> </span><span class="dv">2</span>), <span class="kw">rep</span>(<span class="dv">0</span>, n /<span class="st"> </span><span class="dv">2</span>)), <span class="dt">size =</span> n, <span class="dt">replace =</span> <span class="ot">FALSE</span>)
    diff.means[i] &lt;-<span class="st"> </span><span class="kw">mean</span>(Y1[treat ==<span class="st"> </span><span class="dv">1</span>]) -<span class="st"> </span><span class="kw">mean</span>(Y0[treat ==<span class="st"> </span><span class="dv">0</span>])
}

## estimation error for PATE
est.error &lt;-<span class="st"> </span>diff.means -<span class="st"> </span>PATE

## unbiased
<span class="kw">summary</span>(est.error)</code></pre>
<pre><code>##       Min.    1st Qu.     Median       Mean    3rd Qu.       Max. 
## -0.6947626 -0.1348674 -0.0024725  0.0000347  0.1324152  0.7546195</code></pre>
</div>
<div id="section-7-1-2-standard-error" class="section level3">
<h3 class="hasAnchor">
<a href="#section-7-1-2-standard-error" class="anchor"></a>Section 7.1.2: Standard Error</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">cex =</span> <span class="fl">1.5</span>)
<span class="kw">hist</span>(diff.means, <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">xlab =</span> <span class="st">"Difference-in-means estimator"</span>,
     <span class="dt">main =</span> <span class="st">"Sampling distribution"</span>)
<span class="kw">abline</span>(<span class="dt">v =</span> SATE, <span class="dt">col =</span> <span class="st">"red"</span>) <span class="co"># true value of SATE</span>
<span class="kw">text</span>(<span class="fl">0.6</span>, <span class="fl">2.4</span>, <span class="st">"true SATE"</span>, <span class="dt">col =</span> <span class="st">"red"</span>)</code></pre>
<p><img src="uncertainty_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sd</span>(diff.means)</code></pre>
<pre><code>## [1] 0.1973403</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sqrt</span>(<span class="kw">mean</span>((diff.means -<span class="st"> </span>SATE)^<span class="dv">2</span>))</code></pre>
<pre><code>## [1] 0.2874117</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## PATE simulation with standard error
sims &lt;-<span class="st"> </span><span class="dv">5000</span>
diff.means &lt;-<span class="st"> </span>se &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, sims)  <span class="co"># container for standard error added</span>
for (i in <span class="dv">1</span>:sims) {
    ## generate a sample
    Y0 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean =</span> mu0, <span class="dt">sd =</span> sd0)
    Y1 &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n, <span class="dt">mean =</span> mu1, <span class="dt">sd =</span> sd1)
    ## randomize the treatment by sampling of a vector of 0's and 1's
    treat &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">1</span>, n /<span class="st"> </span><span class="dv">2</span>), <span class="kw">rep</span>(<span class="dv">0</span>, n /<span class="st"> </span><span class="dv">2</span>)), <span class="dt">size =</span> n, <span class="dt">replace =</span> <span class="ot">FALSE</span>)
    diff.means[i] &lt;-<span class="st"> </span><span class="kw">mean</span>(Y1[treat ==<span class="st"> </span><span class="dv">1</span>]) -<span class="st"> </span><span class="kw">mean</span>(Y0[treat ==<span class="st"> </span><span class="dv">0</span>])
    ## standard error
    se[i] &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">var</span>(Y1[treat ==<span class="st"> </span><span class="dv">1</span>]) /<span class="st"> </span>(n /<span class="st"> </span><span class="dv">2</span>) +<span class="st"> </span><span class="kw">var</span>(Y0[treat ==<span class="st"> </span><span class="dv">0</span>]) /<span class="st"> </span>(n /<span class="st"> </span><span class="dv">2</span>))
}

## standard deviation of difference-in-means
<span class="kw">sd</span>(diff.means)</code></pre>
<pre><code>## [1] 0.2006359</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## mean of standard errors
<span class="kw">mean</span>(se)</code></pre>
<pre><code>## [1] 0.199848</code></pre>
</div>
<div id="section-7-1-3-confidence-intervals" class="section level3">
<h3 class="hasAnchor">
<a href="#section-7-1-3-confidence-intervals" class="anchor"></a>Section 7.1.3: Confidence Intervals</h3>
<pre class="sourceCode r"><code class="sourceCode r">n &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="co"># sample size</span>
x.bar &lt;-<span class="st"> </span><span class="fl">0.6</span> <span class="co"># point estimate</span>
s.e. &lt;-<span class="st"> </span><span class="kw">sqrt</span>(x.bar *<span class="st"> </span>(<span class="dv">1</span> -<span class="st"> </span>x.bar) /<span class="st"> </span>n) <span class="co"># standard error</span>
## 99% confidence intervals
<span class="kw">c</span>(x.bar -<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.995</span>) *<span class="st"> </span>s.e., x.bar +<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.995</span>) *<span class="st"> </span>s.e.)</code></pre>
<pre><code>## [1] 0.5600954 0.6399046</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## 95% confidence intervals
<span class="kw">c</span>(x.bar -<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.975</span>) *<span class="st"> </span>s.e., x.bar +<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.975</span>) *<span class="st"> </span>s.e.)</code></pre>
<pre><code>## [1] 0.5696364 0.6303636</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## 90% confidence intervals
<span class="kw">c</span>(x.bar -<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.95</span>) *<span class="st"> </span>s.e., x.bar +<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.95</span>) *<span class="st"> </span>s.e.)</code></pre>
<pre><code>## [1] 0.574518 0.625482</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## empty container matrices for 2 sets of confidence intervals
ci95 &lt;-<span class="st"> </span>ci90 &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> sims)
## 95 percent confidence intervals
ci95[, <span class="dv">1</span>] &lt;-<span class="st"> </span>diff.means -<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.975</span>) *<span class="st"> </span>se <span class="co"># lower limit</span>
ci95[, <span class="dv">2</span>] &lt;-<span class="st"> </span>diff.means +<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.975</span>) *<span class="st"> </span>se <span class="co"># upper limit</span>

## 90 percent confidence intervals
ci90[, <span class="dv">1</span>] &lt;-<span class="st"> </span>diff.means -<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.95</span>) *<span class="st"> </span>se <span class="co"># lower limit</span>
ci90[, <span class="dv">2</span>] &lt;-<span class="st"> </span>diff.means +<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.95</span>) *<span class="st"> </span>se <span class="co"># upper limit</span>

## coverage rate for 95% confidence interval
<span class="kw">mean</span>(ci95[, <span class="dv">1</span>] &lt;=<span class="st"> </span><span class="dv">1</span> &amp;<span class="st"> </span>ci95[, <span class="dv">2</span>] &gt;=<span class="st"> </span><span class="dv">1</span>)</code></pre>
<pre><code>## [1] 0.9452</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## coverage rate for 90% confidence interval
<span class="kw">mean</span>(ci90[, <span class="dv">1</span>] &lt;=<span class="st"> </span><span class="dv">1</span> &amp;<span class="st"> </span>ci90[, <span class="dv">2</span>] &gt;=<span class="st"> </span><span class="dv">1</span>)</code></pre>
<pre><code>## [1] 0.895</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="fl">0.6</span> <span class="co"># true parameter value</span>
n &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">50</span>, <span class="dv">100</span>, <span class="dv">1000</span>) <span class="co"># 3 sample sizes to be examined</span>
alpha &lt;-<span class="st"> </span><span class="fl">0.05</span>
sims &lt;-<span class="st"> </span><span class="dv">5000</span> <span class="co"># number of simulations</span>
results &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, <span class="kw">length</span>(n)) <span class="co"># a container for results</span>

## loop for different sample sizes
for (i in <span class="dv">1</span>:<span class="kw">length</span>(n)) {
    ci.results &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, sims) <span class="co"># a container for whether CI includes truth</span>
    ## loop for repeated hypothetical survey sampling
    for (j in <span class="dv">1</span>:sims) {
        data &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n[i], <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> p) <span class="co"># simple random sampling</span>
        x.bar &lt;-<span class="st"> </span><span class="kw">mean</span>(data) <span class="co"># sample proportion as an estimate</span>
        s.e. &lt;-<span class="st"> </span><span class="kw">sqrt</span>(x.bar *<span class="st"> </span>(<span class="dv">1</span> -<span class="st"> </span>x.bar) /<span class="st"> </span>n[i]) <span class="co"># standard errors</span>
        ci.lower &lt;-<span class="st"> </span>x.bar -<span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> -<span class="st"> </span>alpha/<span class="dv">2</span>) *<span class="st"> </span>s.e.
        ci.upper &lt;-<span class="st"> </span>x.bar +<span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> -<span class="st"> </span>alpha/<span class="dv">2</span>) *<span class="st"> </span>s.e.
        ci.results[j] &lt;-<span class="st"> </span>(p &gt;=<span class="st"> </span>ci.lower) &amp;<span class="st"> </span>(p &lt;=<span class="st"> </span>ci.upper)
    }
    ## proportion of CIs that contain the true value
    results[i] &lt;-<span class="st"> </span><span class="kw">mean</span>(ci.results)
}
results</code></pre>
<pre><code>## [1] 0.9398 0.9516 0.9464</code></pre>
</div>
<div id="scetion-7-1-4-margin-of-error-and-sample-size-calculation-in-polls" class="section level3">
<h3 class="hasAnchor">
<a href="#scetion-7-1-4-margin-of-error-and-sample-size-calculation-in-polls" class="anchor"></a>Scetion 7.1.4: Margin of Error and Sample Size Calculation in Polls</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">cex =</span> <span class="fl">1.5</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)
MoE &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.01</span>, <span class="fl">0.03</span>, <span class="fl">0.05</span>)  <span class="co"># the desired margin of error</span>
p &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">0.01</span>, <span class="dt">to =</span> <span class="fl">0.99</span>, <span class="dt">by =</span> <span class="fl">0.01</span>)
n &lt;-<span class="st"> </span><span class="fl">1.96</span>^<span class="dv">2</span> *<span class="st"> </span>p *<span class="st"> </span>(<span class="dv">1</span> -<span class="st"> </span>p) /<span class="st"> </span>MoE[<span class="dv">1</span>]^<span class="dv">2</span>
<span class="kw">plot</span>(p, n, <span class="dt">ylim =</span> <span class="kw">c</span>(-<span class="dv">1000</span>, <span class="dv">11000</span>), <span class="dt">xlab =</span> <span class="st">"Population proportion"</span>,
     <span class="dt">ylab =</span> <span class="st">"Sample size"</span>, <span class="dt">type =</span> <span class="st">"l"</span>)
<span class="kw">lines</span>(p, <span class="fl">1.96</span>^<span class="dv">2</span> *<span class="st"> </span>p *<span class="st"> </span>(<span class="dv">1</span> -<span class="st"> </span>p) /<span class="st"> </span>MoE[<span class="dv">2</span>]^<span class="dv">2</span>, <span class="dt">lty =</span> <span class="st">"dashed"</span>)
<span class="kw">lines</span>(p, <span class="fl">1.96</span>^<span class="dv">2</span> *<span class="st"> </span>p *<span class="st"> </span>(<span class="dv">1</span> -<span class="st"> </span>p) /<span class="st"> </span>MoE[<span class="dv">3</span>]^<span class="dv">2</span>, <span class="dt">lty =</span> <span class="st">"dotted"</span>)
<span class="kw">text</span>(<span class="fl">0.4</span>, <span class="dv">10000</span>, <span class="st">"margin of error = 0.01"</span>)
<span class="kw">text</span>(<span class="fl">0.4</span>, <span class="dv">1800</span>, <span class="st">"margin of error = 0.03"</span>)
<span class="kw">text</span>(<span class="fl">0.6</span>, -<span class="dv">200</span>, <span class="st">"margin of error = 0.05"</span>)</code></pre>
<p><img src="uncertainty_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<pre class="sourceCode r"><code class="sourceCode r">## election and polling results, by state
<span class="kw">data</span>(<span class="st">"pres08"</span>, <span class="dt">package =</span> <span class="st">"qss"</span>)
<span class="kw">data</span>(<span class="st">"polls08"</span>, <span class="dt">package =</span> <span class="st">"qss"</span>)

## convert to a Date object
polls08$middate &lt;-<span class="st"> </span><span class="kw">as.Date</span>(polls08$middate)
## number of days to the election day
polls08$DaysToElection &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="st">"2008-11-04"</span>) -<span class="st"> </span>polls08$middate</code></pre>
<pre><code>## Warning in strptime(xx, f &lt;- "%Y-%m-%d", tz = "GMT"): unknown timezone
## 'zone/tz/2017c.1.0/zoneinfo/America/New_York'</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## create a matrix place holder
poll.pred &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">nrow =</span> <span class="dv">51</span>, <span class="dt">ncol =</span> <span class="dv">3</span>)

## state names which the loop will iterate through
st.names &lt;-<span class="st"> </span><span class="kw">unique</span>(pres08$state)
## add labels for easy interpretation later on
<span class="kw">row.names</span>(poll.pred) &lt;-<span class="st"> </span><span class="kw">as.character</span>(st.names)

## loop across 50 states plus DC
for (i in <span class="dv">1</span>:<span class="dv">51</span>){
    ## subset the ith state
    state.data &lt;-<span class="st"> </span><span class="kw">subset</span>(polls08, <span class="dt">subset =</span> (state ==<span class="st"> </span>st.names[i]))
    ## subset the latest polls within the state
    latest &lt;-<span class="st"> </span>state.data$DaysToElection ==<span class="st"> </span><span class="kw">min</span>(state.data$DaysToElection)
    ## compute the mean of latest polls and store it
    poll.pred[i, <span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw">mean</span>(state.data$Obama[latest]) /<span class="st"> </span><span class="dv">100</span>
}

## upper and lower confidence limits
n &lt;-<span class="st"> </span><span class="dv">1000</span> <span class="co"># sample size</span>
alpha &lt;-<span class="st"> </span><span class="fl">0.05</span>
s.e. &lt;-<span class="st"> </span><span class="kw">sqrt</span>(poll.pred[, <span class="dv">1</span>] *<span class="st"> </span>(<span class="dv">1</span> -<span class="st"> </span>poll.pred[, <span class="dv">1</span>]) /<span class="st"> </span>n) <span class="co"># standard error</span>
poll.pred[, <span class="dv">2</span>] &lt;-<span class="st"> </span>poll.pred[, <span class="dv">1</span>] -<span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> -<span class="st"> </span>alpha/<span class="dv">2</span>) *<span class="st"> </span>s.e.
poll.pred[, <span class="dv">3</span>] &lt;-<span class="st"> </span>poll.pred[, <span class="dv">1</span>] +<span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> -<span class="st"> </span>alpha/<span class="dv">2</span>) *<span class="st"> </span>s.e.

<span class="kw">par</span>(<span class="dt">cex =</span> <span class="fl">1.5</span>)
alpha &lt;-<span class="st"> </span><span class="fl">0.05</span>
<span class="kw">plot</span>(pres08$Obama /<span class="st"> </span><span class="dv">100</span>, poll.pred[, <span class="dv">1</span>], <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),
     <span class="dt">xlab =</span> <span class="st">"Obama's vote share"</span>, <span class="dt">ylab =</span> <span class="st">"Poll prediction"</span>)
<span class="kw">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>)

## adding 95% confidence intervals for each state
for (i in <span class="dv">1</span>:<span class="dv">51</span>) {
    <span class="kw">lines</span>(<span class="kw">rep</span>(pres08$Obama[i] /<span class="st"> </span><span class="dv">100</span>, <span class="dv">2</span>), <span class="kw">c</span>(poll.pred[i, <span class="dv">2</span>], poll.pred[i, <span class="dv">3</span>]))
}</code></pre>
<p><img src="uncertainty_files/figure-html/unnamed-chunk-4-2.png" width="672"></p>
<pre class="sourceCode r"><code class="sourceCode r">## proportion of confidence intervals that contain the election day outcome
<span class="kw">mean</span>((poll.pred[, <span class="dv">2</span>] &lt;=<span class="st"> </span>pres08$Obama /<span class="st"> </span><span class="dv">100</span>) &amp;
<span class="st">         </span>(poll.pred[, <span class="dv">3</span>] &gt;=<span class="st"> </span>pres08$Obama /<span class="st"> </span><span class="dv">100</span>))</code></pre>
<pre><code>## [1] 0.5882353</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## bias
bias &lt;-<span class="st"> </span><span class="kw">mean</span>(poll.pred[, <span class="dv">1</span>] -<span class="st"> </span>pres08$Obama /<span class="st"> </span><span class="dv">100</span>)
bias</code></pre>
<pre><code>## [1] -0.02679739</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## bias corrected estimate
poll.bias &lt;-<span class="st"> </span>poll.pred[, <span class="dv">1</span>] -<span class="st"> </span>bias
## bias-corrected standard error
s.e.bias &lt;-<span class="st"> </span><span class="kw">sqrt</span>(poll.bias *<span class="st"> </span>(<span class="dv">1</span> -<span class="st"> </span>poll.bias) /<span class="st"> </span>n)
## bias-corrected 95% confidence interval
ci.bias.lower &lt;-<span class="st"> </span>poll.bias -<span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> -<span class="st"> </span>alpha /<span class="st"> </span><span class="dv">2</span>) *<span class="st"> </span>s.e.bias
ci.bias.upper &lt;-<span class="st"> </span>poll.bias +<span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> -<span class="st"> </span>alpha /<span class="st"> </span><span class="dv">2</span>) *<span class="st"> </span>s.e.bias

## proportion of bias-corrected CIs that contain the election day outcome
<span class="kw">mean</span>((ci.bias.lower &lt;=<span class="st"> </span>pres08$Obama /<span class="st"> </span><span class="dv">100</span>) &amp;
<span class="st">         </span>(ci.bias.upper &gt;=<span class="st"> </span>pres08$Obama /<span class="st"> </span><span class="dv">100</span>))</code></pre>
<pre><code>## [1] 0.7647059</code></pre>
</div>
<div id="section-7-1-5-analysis-of-randomized-controlled-trials" class="section level3">
<h3 class="hasAnchor">
<a href="#section-7-1-5-analysis-of-randomized-controlled-trials" class="anchor"></a>Section 7.1.5: Analysis of Randomized Controlled Trials</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">cex =</span> <span class="fl">1.5</span>)
## read in data
<span class="kw">data</span>(<span class="st">"STAR"</span>, <span class="dt">package =</span> <span class="st">"qss"</span>)
<span class="kw">hist</span>(STAR$g4reading[STAR$classtype ==<span class="st"> </span><span class="dv">1</span>], <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">500</span>, <span class="dv">900</span>),
     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.01</span>), <span class="dt">main =</span> <span class="st">"Small class"</span>,
     <span class="dt">xlab =</span> <span class="st">"Fourth-grade reading test score"</span>)
<span class="kw">abline</span>(<span class="dt">v =</span> <span class="kw">mean</span>(STAR$g4reading[STAR$classtype ==<span class="st"> </span><span class="dv">1</span>], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
       <span class="dt">col =</span> <span class="st">"red"</span>)</code></pre>
<p><img src="uncertainty_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(STAR$g4reading[STAR$classtype ==<span class="st"> </span><span class="dv">2</span>], <span class="dt">freq =</span> <span class="ot">FALSE</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">500</span>, <span class="dv">900</span>),
     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.01</span>), <span class="dt">main =</span> <span class="st">"Regular class"</span>,
     <span class="dt">xlab =</span> <span class="st">"Fourth-grade reading test score"</span>)
<span class="kw">abline</span>(<span class="dt">v =</span> <span class="kw">mean</span>(STAR$g4reading[STAR$classtype ==<span class="st"> </span><span class="dv">2</span>], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
       <span class="dt">col =</span> <span class="st">"red"</span>)</code></pre>
<p><img src="uncertainty_files/figure-html/unnamed-chunk-5-2.png" width="672"></p>
<pre class="sourceCode r"><code class="sourceCode r">## estimate and standard error for small class
n.small &lt;-<span class="st"> </span><span class="kw">sum</span>(STAR$classtype ==<span class="st"> </span><span class="dv">1</span> &amp;<span class="st"> </span>!<span class="kw">is.na</span>(STAR$g4reading))
est.small &lt;-<span class="st"> </span><span class="kw">mean</span>(STAR$g4reading[STAR$classtype ==<span class="st"> </span><span class="dv">1</span>], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
se.small &lt;-<span class="st"> </span><span class="kw">sd</span>(STAR$g4reading[STAR$classtype ==<span class="st"> </span><span class="dv">1</span>], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) /
<span class="st">    </span><span class="kw">sqrt</span>(n.small)
est.small</code></pre>
<pre><code>## [1] 723.3912</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">se.small</code></pre>
<pre><code>## [1] 1.913012</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## estimate and standard error for regular class
n.regular &lt;-<span class="st"> </span><span class="kw">sum</span>(STAR$classtype ==<span class="st"> </span><span class="dv">2</span> &amp;<span class="st"> </span>!<span class="kw">is.na</span>(STAR$classtype) &amp;
<span class="st">                     </span>!<span class="kw">is.na</span>(STAR$g4reading))
est.regular &lt;-<span class="st"> </span><span class="kw">mean</span>(STAR$g4reading[STAR$classtype ==<span class="st"> </span><span class="dv">2</span>], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
se.regular &lt;-<span class="st"> </span><span class="kw">sd</span>(STAR$g4reading[STAR$classtype ==<span class="st"> </span><span class="dv">2</span>], <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) /
<span class="st">    </span><span class="kw">sqrt</span>(n.regular)
est.regular</code></pre>
<pre><code>## [1] 719.89</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">se.regular</code></pre>
<pre><code>## [1] 1.83885</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">alpha &lt;-<span class="st"> </span><span class="fl">0.05</span>
## 95% confidence intervals for small class
ci.small &lt;-<span class="st"> </span><span class="kw">c</span>(est.small -<span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> -<span class="st"> </span>alpha /<span class="st"> </span><span class="dv">2</span>) *<span class="st"> </span>se.small,
              est.small +<span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> -<span class="st"> </span>alpha /<span class="st"> </span><span class="dv">2</span>) *<span class="st"> </span>se.small)
ci.small</code></pre>
<pre><code>## [1] 719.6417 727.1406</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## 95% confidence intervals for regular class
ci.regular &lt;-<span class="st"> </span><span class="kw">c</span>(est.regular -<span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> -<span class="st"> </span>alpha /<span class="st"> </span><span class="dv">2</span>) *<span class="st"> </span>se.regular,
                est.regular +<span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> -<span class="st"> </span>alpha /<span class="st"> </span><span class="dv">2</span>) *<span class="st"> </span>se.regular)
ci.regular</code></pre>
<pre><code>## [1] 716.2859 723.4940</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## difference-in-means estimator
ate.est &lt;-<span class="st"> </span>est.small -<span class="st"> </span>est.regular
ate.est</code></pre>
<pre><code>## [1] 3.501232</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## standard error and 95% confidence interval
ate.se &lt;-<span class="st"> </span><span class="kw">sqrt</span>(se.small^<span class="dv">2</span> +<span class="st"> </span>se.regular^<span class="dv">2</span>)
ate.se</code></pre>
<pre><code>## [1] 2.653485</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">ate.ci &lt;-<span class="st"> </span><span class="kw">c</span>(ate.est -<span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> -<span class="st"> </span>alpha /<span class="st"> </span><span class="dv">2</span>) *<span class="st"> </span>ate.se,
            ate.est +<span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> -<span class="st"> </span>alpha /<span class="st"> </span><span class="dv">2</span>) *<span class="st"> </span>ate.se)
ate.ci</code></pre>
<pre><code>## [1] -1.699503  8.701968</code></pre>
</div>
<div id="section-7-1-6-analysis-based-on-students-t-distribution" class="section level3">
<h3 class="hasAnchor">
<a href="#section-7-1-6-analysis-based-on-students-t-distribution" class="anchor"></a>Section 7.1.6: Analysis Based on Studentâ€™s t-Distribution</h3>
<pre class="sourceCode r"><code class="sourceCode r">## 95% CI for small class
<span class="kw">c</span>(est.small -<span class="st"> </span><span class="kw">qt</span>(<span class="fl">0.975</span>, <span class="dt">df =</span> n.small -<span class="st"> </span><span class="dv">1</span>) *<span class="st"> </span>se.small,
  est.small +<span class="st"> </span><span class="kw">qt</span>(<span class="fl">0.975</span>, <span class="dt">df =</span> n.small -<span class="st"> </span><span class="dv">1</span>) *<span class="st"> </span>se.small)</code></pre>
<pre><code>## [1] 719.6355 727.1469</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## 95% CI based on the central limit theorem
ci.small</code></pre>
<pre><code>## [1] 719.6417 727.1406</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## 95% CI for regular class
<span class="kw">c</span>(est.regular -<span class="st"> </span><span class="kw">qt</span>(<span class="fl">0.975</span>, <span class="dt">df =</span> n.regular -<span class="st"> </span><span class="dv">1</span>) *<span class="st"> </span>se.regular,
  est.regular +<span class="st"> </span><span class="kw">qt</span>(<span class="fl">0.975</span>, <span class="dt">df =</span> n.regular -<span class="st"> </span><span class="dv">1</span>) *<span class="st"> </span>se.regular)</code></pre>
<pre><code>## [1] 716.2806 723.4993</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## 95% CI based on the central limit theorem
ci.regular</code></pre>
<pre><code>## [1] 716.2859 723.4940</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">t.ci &lt;-<span class="st"> </span><span class="kw">t.test</span>(STAR$g4reading[STAR$classtype ==<span class="st"> </span><span class="dv">1</span>],
               STAR$g4reading[STAR$classtype ==<span class="st"> </span><span class="dv">2</span>])
t.ci</code></pre>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  STAR$g4reading[STAR$classtype == 1] and STAR$g4reading[STAR$classtype == 2]
## t = 1.3195, df = 1541.2, p-value = 0.1872
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -1.703591  8.706055
## sample estimates:
## mean of x mean of y 
##  723.3912  719.8900</code></pre>
</div>
</div>
<div id="section-7-2-hypothesis-testing" class="section level2">
<h2 class="hasAnchor">
<a href="#section-7-2-hypothesis-testing" class="anchor"></a>Section 7.2: Hypothesis Testing</h2>
<div id="section-7-2-1-tea-testing-experiment" class="section level3">
<h3 class="hasAnchor">
<a href="#section-7-2-1-tea-testing-experiment" class="anchor"></a>Section 7.2.1: Tea-Testing Experiment</h3>
<pre class="sourceCode r"><code class="sourceCode r">## truth: enumerate the number of assignment combinations
true &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">choose</span>(<span class="dv">4</span>, <span class="dv">0</span>) *<span class="st"> </span><span class="kw">choose</span>(<span class="dv">4</span>, <span class="dv">4</span>),
          <span class="kw">choose</span>(<span class="dv">4</span>, <span class="dv">1</span>) *<span class="st"> </span><span class="kw">choose</span>(<span class="dv">4</span>, <span class="dv">3</span>),
          <span class="kw">choose</span>(<span class="dv">4</span>, <span class="dv">2</span>) *<span class="st"> </span><span class="kw">choose</span>(<span class="dv">4</span>, <span class="dv">2</span>),
          <span class="kw">choose</span>(<span class="dv">4</span>, <span class="dv">3</span>) *<span class="st"> </span><span class="kw">choose</span>(<span class="dv">4</span>, <span class="dv">1</span>),
          <span class="kw">choose</span>(<span class="dv">4</span>, <span class="dv">4</span>) *<span class="st"> </span><span class="kw">choose</span>(<span class="dv">4</span>, <span class="dv">0</span>))
true</code></pre>
<pre><code>## [1]  1 16 36 16  1</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## compute probability: divide it by the total number of events
true &lt;-<span class="st"> </span>true /<span class="st"> </span><span class="kw">sum</span>(true)
## number of correctly classified cups as labels
<span class="kw">names</span>(true) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>)
true</code></pre>
<pre><code>##          0          2          4          6          8 
## 0.01428571 0.22857143 0.51428571 0.22857143 0.01428571</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## simulations
sims &lt;-<span class="st"> </span><span class="dv">1000</span>
## lady's guess: M stands for `Milk first,' T stands for `Tea first'
guess &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"M"</span>, <span class="st">"T"</span>, <span class="st">"T"</span>, <span class="st">"M"</span>, <span class="st">"M"</span>, <span class="st">"T"</span>, <span class="st">"T"</span>, <span class="st">"M"</span>)
correct &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>, sims) <span class="co"># place holder for number of correct guesses</span>
for (i in <span class="dv">1</span>:sims) {
    ## randomize which cups get Milk/Tea first
    cups &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">"T"</span>, <span class="dv">4</span>), <span class="kw">rep</span>(<span class="st">"M"</span>, <span class="dv">4</span>)), <span class="dt">replace =</span> <span class="ot">FALSE</span>)
    correct[i] &lt;-<span class="st"> </span><span class="kw">sum</span>(guess ==<span class="st"> </span>cups) <span class="co"># number of correct guesses</span>
}
## estimated probability for each number of correct guesses
<span class="kw">prop.table</span>(<span class="kw">table</span>(correct))</code></pre>
<pre><code>## correct
##     0     2     4     6     8 
## 0.017 0.227 0.506 0.238 0.012</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## comparison with analytical answers; the differences are small
<span class="kw">prop.table</span>(<span class="kw">table</span>(correct)) -<span class="st"> </span>true</code></pre>
<pre><code>## correct
##            0            2            4            6            8 
##  0.002714286 -0.001571429 -0.008285714  0.009428571 -0.002285714</code></pre>
</div>
<div id="section-7-2-2-the-general-framework" class="section level3">
<h3 class="hasAnchor">
<a href="#section-7-2-2-the-general-framework" class="anchor"></a>Section 7.2.2: The General Framework</h3>
<pre class="sourceCode r"><code class="sourceCode r">## all correct
x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">4</span>), <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)
## six correct
y &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>), <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">2</span>)

## `M' milk first, `T' tea first
<span class="kw">rownames</span>(x) &lt;-<span class="st"> </span><span class="kw">colnames</span>(x) &lt;-<span class="st"> </span><span class="kw">rownames</span>(y) &lt;-<span class="st"> </span><span class="kw">colnames</span>(y) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"M"</span>, <span class="st">"T"</span>)
x</code></pre>
<pre><code>##   M T
## M 4 0
## T 0 4</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">y</code></pre>
<pre><code>##   M T
## M 3 1
## T 1 3</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## one-sided test for 8 correct guesses
<span class="kw">fisher.test</span>(x, <span class="dt">alternative =</span> <span class="st">"greater"</span>)</code></pre>
<pre><code>## 
##  Fisher's Exact Test for Count Data
## 
## data:  x
## p-value = 0.01429
## alternative hypothesis: true odds ratio is greater than 1
## 95 percent confidence interval:
##  2.003768      Inf
## sample estimates:
## odds ratio 
##        Inf</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## two-sided test for 6 correct guesses
<span class="kw">fisher.test</span>(y)</code></pre>
<pre><code>## 
##  Fisher's Exact Test for Count Data
## 
## data:  y
## p-value = 0.4857
## alternative hypothesis: true odds ratio is not equal to 1
## 95 percent confidence interval:
##    0.2117329 621.9337505
## sample estimates:
## odds ratio 
##   6.408309</code></pre>
</div>
<div id="section-7-2-3-one-sample-tests" class="section level3">
<h3 class="hasAnchor">
<a href="#section-7-2-3-one-sample-tests" class="anchor"></a>Section 7.2.3: One-Sample Tests</h3>
<pre class="sourceCode r"><code class="sourceCode r">n &lt;-<span class="st"> </span><span class="dv">1018</span>
x.bar &lt;-<span class="st"> </span><span class="dv">550</span> /<span class="st"> </span>n
se &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="fl">0.5</span> *<span class="st"> </span><span class="fl">0.5</span> /<span class="st"> </span>n) <span class="co"># standard deviation of sampling distribution</span>

## upper red area in the figure
upper &lt;-<span class="st"> </span><span class="kw">pnorm</span>(x.bar, <span class="dt">mean =</span> <span class="fl">0.5</span>, <span class="dt">sd =</span> se, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)

## lower red area in the figure; identical to the upper area
lower &lt;-<span class="st"> </span><span class="kw">pnorm</span>(<span class="fl">0.5</span> -<span class="st"> </span>(x.bar -<span class="st"> </span><span class="fl">0.5</span>), <span class="dt">mean =</span> <span class="fl">0.5</span>, <span class="dt">sd =</span> se)

## two-side p-value
upper +<span class="st"> </span>lower</code></pre>
<pre><code>## [1] 0.01016866</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="dv">2</span> *<span class="st"> </span>upper</code></pre>
<pre><code>## [1] 0.01016866</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## one-sided p-value
upper</code></pre>
<pre><code>## [1] 0.005084332</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">z.score &lt;-<span class="st"> </span>(x.bar -<span class="st"> </span><span class="fl">0.5</span>) /<span class="st"> </span>se
z.score</code></pre>
<pre><code>## [1] 2.57004</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pnorm</span>(z.score, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>) <span class="co"># one-sided p-value</span></code></pre>
<pre><code>## [1] 0.005084332</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="dv">2</span> *<span class="st"> </span><span class="kw">pnorm</span>(z.score, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>) <span class="co"># two-sided p-value</span></code></pre>
<pre><code>## [1] 0.01016866</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## 99% confidence interval contains 0.5
<span class="kw">c</span>(x.bar -<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.995</span>) *<span class="st"> </span>se, x.bar +<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.995</span>) *<span class="st"> </span>se)</code></pre>
<pre><code>## [1] 0.4999093 0.5806408</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## 95% confidence interval does not contain 0.5
<span class="kw">c</span>(x.bar -<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.975</span>) *<span class="st"> </span>se, x.bar +<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.975</span>) *<span class="st"> </span>se)</code></pre>
<pre><code>## [1] 0.5095605 0.5709896</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## no continuity correction to get the same p-value as above
<span class="kw">prop.test</span>(<span class="dv">550</span>, <span class="dt">n =</span> n, <span class="dt">p =</span> <span class="fl">0.5</span>, <span class="dt">correct =</span> <span class="ot">FALSE</span>)</code></pre>
<pre><code>## 
##  1-sample proportions test without continuity correction
## 
## data:  550 out of n, null probability 0.5
## X-squared = 6.6051, df = 1, p-value = 0.01017
## alternative hypothesis: true p is not equal to 0.5
## 95 percent confidence interval:
##  0.5095661 0.5706812
## sample estimates:
##        p 
## 0.540275</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## with continuity correction
<span class="kw">prop.test</span>(<span class="dv">550</span>, <span class="dt">n =</span> n, <span class="dt">p =</span> <span class="fl">0.5</span>)</code></pre>
<pre><code>## 
##  1-sample proportions test with continuity correction
## 
## data:  550 out of n, null probability 0.5
## X-squared = 6.445, df = 1, p-value = 0.01113
## alternative hypothesis: true p is not equal to 0.5
## 95 percent confidence interval:
##  0.5090744 0.5711680
## sample estimates:
##        p 
## 0.540275</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.test</span>(<span class="dv">550</span>, <span class="dt">n =</span> n, <span class="dt">p =</span> <span class="fl">0.5</span>, <span class="dt">conf.level =</span> <span class="fl">0.99</span>)</code></pre>
<pre><code>## 
##  1-sample proportions test with continuity correction
## 
## data:  550 out of n, null probability 0.5
## X-squared = 6.445, df = 1, p-value = 0.01113
## alternative hypothesis: true p is not equal to 0.5
## 99 percent confidence interval:
##  0.4994182 0.5806040
## sample estimates:
##        p 
## 0.540275</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## two-sided one-sample t-test
<span class="kw">t.test</span>(STAR$g4reading, <span class="dt">mu =</span> <span class="dv">710</span>)</code></pre>
<pre><code>## 
##  One Sample t-test
## 
## data:  STAR$g4reading
## t = 10.407, df = 2352, p-value &lt; 2.2e-16
## alternative hypothesis: true mean is not equal to 710
## 95 percent confidence interval:
##  719.1284 723.3671
## sample estimates:
## mean of x 
##  721.2478</code></pre>
</div>
<div id="section-7-2-4-two-sample-tests" class="section level3">
<h3 class="hasAnchor">
<a href="#section-7-2-4-two-sample-tests" class="anchor"></a>Section 7.2.4: Two-Sample Tests</h3>
<pre class="sourceCode r"><code class="sourceCode r">## one-sided p-value
<span class="kw">pnorm</span>(-<span class="kw">abs</span>(ate.est), <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> ate.se)</code></pre>
<pre><code>## [1] 0.09350361</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## two-sided p-value
<span class="dv">2</span> *<span class="st"> </span><span class="kw">pnorm</span>(-<span class="kw">abs</span>(ate.est), <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> ate.se)</code></pre>
<pre><code>## [1] 0.1870072</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## testing the null of zero average treatment effect
<span class="kw">t.test</span>(STAR$g4reading[STAR$classtype ==<span class="st"> </span><span class="dv">1</span>],
       STAR$g4reading[STAR$classtype ==<span class="st"> </span><span class="dv">2</span>])</code></pre>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  STAR$g4reading[STAR$classtype == 1] and STAR$g4reading[STAR$classtype == 2]
## t = 1.3195, df = 1541.2, p-value = 0.1872
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -1.703591  8.706055
## sample estimates:
## mean of x mean of y 
##  723.3912  719.8900</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">"resume"</span>, <span class="dt">package =</span> <span class="st">"qss"</span>)

## organize the data in tables
x &lt;-<span class="st"> </span><span class="kw">table</span>(resume$race, resume$call)
x</code></pre>
<pre><code>##        
##            0    1
##   black 2278  157
##   white 2200  235</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## one-sided test
<span class="kw">prop.test</span>(x, <span class="dt">alternative =</span> <span class="st">"greater"</span>)</code></pre>
<pre><code>## 
##  2-sample test for equality of proportions with continuity
##  correction
## 
## data:  x
## X-squared = 16.449, df = 1, p-value = 2.499e-05
## alternative hypothesis: greater
## 95 percent confidence interval:
##  0.01881967 1.00000000
## sample estimates:
##    prop 1    prop 2 
## 0.9355236 0.9034908</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## sample size
n0 &lt;-<span class="st"> </span><span class="kw">sum</span>(resume$race ==<span class="st"> "black"</span>)
n1 &lt;-<span class="st"> </span><span class="kw">sum</span>(resume$race ==<span class="st"> "white"</span>)

## sample proportions
p &lt;-<span class="st"> </span><span class="kw">mean</span>(resume$call) <span class="co"># overall</span>
p0 &lt;-<span class="st"> </span><span class="kw">mean</span>(resume$call[resume$race ==<span class="st"> "black"</span>]) <span class="co"># black</span>
p1 &lt;-<span class="st"> </span><span class="kw">mean</span>(resume$call[resume$race ==<span class="st"> "white"</span>]) <span class="co"># white</span>

## point estimate
est &lt;-<span class="st"> </span>p1 -<span class="st"> </span>p0
est</code></pre>
<pre><code>## [1] 0.03203285</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## standard error
se &lt;-<span class="st"> </span><span class="kw">sqrt</span>(p *<span class="st"> </span>(<span class="dv">1</span> -<span class="st"> </span>p) *<span class="st"> </span>(<span class="dv">1</span> /<span class="st"> </span>n0 +<span class="st"> </span><span class="dv">1</span> /<span class="st"> </span>n1))
se</code></pre>
<pre><code>## [1] 0.007796894</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## z-statistic
zstat &lt;-<span class="st"> </span>est /<span class="st"> </span>se
zstat</code></pre>
<pre><code>## [1] 4.108412</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## one-sided p-value
<span class="kw">pnorm</span>(-<span class="kw">abs</span>(zstat))</code></pre>
<pre><code>## [1] 1.991943e-05</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">prop.test</span>(x, <span class="dt">alternative =</span> <span class="st">"greater"</span>, <span class="dt">correct =</span> <span class="ot">FALSE</span>)</code></pre>
<pre><code>## 
##  2-sample test for equality of proportions without continuity
##  correction
## 
## data:  x
## X-squared = 16.879, df = 1, p-value = 1.992e-05
## alternative hypothesis: greater
## 95 percent confidence interval:
##  0.01923035 1.00000000
## sample estimates:
##    prop 1    prop 2 
## 0.9355236 0.9034908</code></pre>
</div>
<div id="section-7-2-5-pitfalls-of-hypothesis-testing" class="section level3">
<h3 class="hasAnchor">
<a href="#section-7-2-5-pitfalls-of-hypothesis-testing" class="anchor"></a>Section 7.2.5: Pitfalls of Hypothesis Testing</h3>
</div>
<div id="section-7-2-6-power-analysis" class="section level3">
<h3 class="hasAnchor">
<a href="#section-7-2-6-power-analysis" class="anchor"></a>Section 7.2.6: Power Analysis</h3>
<pre class="sourceCode r"><code class="sourceCode r">## set the parameters
n &lt;-<span class="st"> </span><span class="dv">250</span>
p.star &lt;-<span class="st"> </span><span class="fl">0.48</span> <span class="co"># data generating process</span>
p &lt;-<span class="st"> </span><span class="fl">0.5</span> <span class="co"># null value</span>
alpha &lt;-<span class="st"> </span><span class="fl">0.05</span>

## critical value
cr.value &lt;-<span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> -<span class="st"> </span>alpha /<span class="st"> </span><span class="dv">2</span>)

## standard errors under the hypothetical data generating process
se.star &lt;-<span class="st"> </span><span class="kw">sqrt</span>(p.star *<span class="st"> </span>(<span class="dv">1</span> -<span class="st"> </span>p.star) /<span class="st"> </span>n)

## standard error under the null
se &lt;-<span class="st"> </span><span class="kw">sqrt</span>(p *<span class="st"> </span>(<span class="dv">1</span> -<span class="st"> </span>p) /<span class="st"> </span>n)

## power
<span class="kw">pnorm</span>(p -<span class="st"> </span>cr.value *<span class="st"> </span>se, <span class="dt">mean =</span> p.star, <span class="dt">sd =</span> se.star) +
<span class="st">    </span><span class="kw">pnorm</span>(p +<span class="st"> </span>cr.value *<span class="st"> </span>se, <span class="dt">mean =</span> p.star, <span class="dt">sd =</span> se.star, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</code></pre>
<pre><code>## [1] 0.09673114</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## parameters
n1 &lt;-<span class="st"> </span><span class="dv">500</span>
n0 &lt;-<span class="st"> </span><span class="dv">500</span>
p1.star &lt;-<span class="st"> </span><span class="fl">0.05</span>
p0.star &lt;-<span class="st"> </span><span class="fl">0.1</span>

## overall call back rate as a weighted average
p &lt;-<span class="st"> </span>(n1 *<span class="st"> </span>p1.star +<span class="st"> </span>n0 *<span class="st"> </span>p0.star) /<span class="st"> </span>(n1 +<span class="st"> </span>n0)
## standard error under the null
se &lt;-<span class="st"> </span><span class="kw">sqrt</span>(p *<span class="st"> </span>(<span class="dv">1</span> -<span class="st"> </span>p) *<span class="st"> </span>(<span class="dv">1</span> /<span class="st"> </span>n1 +<span class="st"> </span><span class="dv">1</span> /<span class="st"> </span>n0))
## standard error under the hypothetical data generating process
se.star &lt;-<span class="st"> </span><span class="kw">sqrt</span>(p1.star *<span class="st"> </span>(<span class="dv">1</span> -<span class="st"> </span>p1.star) /<span class="st"> </span>n1 +<span class="st"> </span>p0.star *<span class="st"> </span>(<span class="dv">1</span> -<span class="st"> </span>p0.star) /<span class="st"> </span>n0)

<span class="kw">pnorm</span>(-cr.value *<span class="st"> </span>se, <span class="dt">mean =</span> p1.star -<span class="st"> </span>p0.star, <span class="dt">sd =</span> se.star) +
<span class="st">    </span><span class="kw">pnorm</span>(cr.value *<span class="st"> </span>se, <span class="dt">mean =</span> p1.star -<span class="st"> </span>p0.star, <span class="dt">sd =</span> se.star,
          <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</code></pre>
<pre><code>## [1] 0.85228</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">power.prop.test</span>(<span class="dt">n =</span> <span class="dv">500</span>, <span class="dt">p1 =</span> <span class="fl">0.05</span>, <span class="dt">p2 =</span> <span class="fl">0.1</span>, <span class="dt">sig.level =</span> <span class="fl">0.05</span>)</code></pre>
<pre><code>## 
##      Two-sample comparison of proportions power calculation 
## 
##               n = 500
##              p1 = 0.05
##              p2 = 0.1
##       sig.level = 0.05
##           power = 0.8522797
##     alternative = two.sided
## 
## NOTE: n is number in *each* group</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">power.prop.test</span>(<span class="dt">p1 =</span> <span class="fl">0.05</span>, <span class="dt">p2 =</span> <span class="fl">0.1</span>, <span class="dt">sig.level =</span> <span class="fl">0.05</span>, <span class="dt">power =</span> <span class="fl">0.9</span>)</code></pre>
<pre><code>## 
##      Two-sample comparison of proportions power calculation 
## 
##               n = 581.0821
##              p1 = 0.05
##              p2 = 0.1
##       sig.level = 0.05
##           power = 0.9
##     alternative = two.sided
## 
## NOTE: n is number in *each* group</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">power.t.test</span>(<span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">delta =</span> <span class="fl">0.25</span>, <span class="dt">sd =</span> <span class="dv">1</span>, <span class="dt">type =</span> <span class="st">"one.sample"</span>)</code></pre>
<pre><code>## 
##      One-sample t test power calculation 
## 
##               n = 100
##           delta = 0.25
##              sd = 1
##       sig.level = 0.05
##           power = 0.6969757
##     alternative = two.sided</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">power.t.test</span>(<span class="dt">power =</span> <span class="fl">0.9</span>, <span class="dt">delta =</span> <span class="fl">0.25</span>, <span class="dt">sd =</span> <span class="dv">1</span>, <span class="dt">type =</span> <span class="st">"one.sample"</span>)</code></pre>
<pre><code>## 
##      One-sample t test power calculation 
## 
##               n = 170.0511
##           delta = 0.25
##              sd = 1
##       sig.level = 0.05
##           power = 0.9
##     alternative = two.sided</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">power.t.test</span>(<span class="dt">delta =</span> <span class="fl">0.25</span>, <span class="dt">sd =</span> <span class="dv">1</span>, <span class="dt">type =</span> <span class="st">"two.sample"</span>,
             <span class="dt">alternative =</span> <span class="st">"one.sided"</span>, <span class="dt">power =</span> <span class="fl">0.9</span>)</code></pre>
<pre><code>## 
##      Two-sample t test power calculation 
## 
##               n = 274.7222
##           delta = 0.25
##              sd = 1
##       sig.level = 0.05
##           power = 0.9
##     alternative = one.sided
## 
## NOTE: n is number in *each* group</code></pre>
</div>
</div>
<div id="section-7-3-linear-regression-model-with-uncertainty" class="section level2">
<h2 class="hasAnchor">
<a href="#section-7-3-linear-regression-model-with-uncertainty" class="anchor"></a>Section 7.3: Linear Regression Model with Uncertainty</h2>
<div id="section-7-3-1-linear-regression-as-a-generative-model" class="section level3">
<h3 class="hasAnchor">
<a href="#section-7-3-1-linear-regression-as-a-generative-model" class="anchor"></a>Section 7.3.1: Linear Regression as a Generative Model</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">"minwage"</span>, <span class="dt">package =</span> <span class="st">"qss"</span>)

## compute proportion of full employment before minimum wage increase
minwage$fullPropBefore &lt;-<span class="st"> </span>minwage$fullBefore /
<span class="st">    </span>(minwage$fullBefore +<span class="st"> </span>minwage$partBefore)

## same thing after minimum wage increase
minwage$fullPropAfter &lt;-<span class="st"> </span>minwage$fullAfter /
<span class="st">    </span>(minwage$fullAfter +<span class="st"> </span>minwage$partAfter)

## an indicator for NJ: 1 if it's located in NJ and 0 if in PA
minwage$NJ &lt;-<span class="st"> </span><span class="kw">ifelse</span>(minwage$location ==<span class="st"> "PA"</span>, <span class="dv">0</span>, <span class="dv">1</span>)

fit.minwage &lt;-<span class="st"> </span><span class="kw">lm</span>(fullPropAfter ~<span class="st"> </span>-<span class="dv">1</span> +<span class="st"> </span>NJ +<span class="st"> </span>fullPropBefore +
<span class="st">                      </span>wageBefore +<span class="st"> </span>chain, <span class="dt">data =</span> minwage)

## regression result
fit.minwage</code></pre>
<pre><code>## 
## Call:
## lm(formula = fullPropAfter ~ -1 + NJ + fullPropBefore + wageBefore + 
##     chain, data = minwage)
## 
## Coefficients:
##              NJ   fullPropBefore       wageBefore  chainburgerking  
##         0.05422          0.16879          0.08133         -0.11563  
##        chainkfc        chainroys      chainwendys  
##        -0.15080         -0.20639         -0.22013</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">fit.minwage1 &lt;-<span class="st"> </span><span class="kw">lm</span>(fullPropAfter ~<span class="st"> </span>NJ +<span class="st"> </span>fullPropBefore +
<span class="st">                       </span>wageBefore +<span class="st"> </span>chain, <span class="dt">data =</span> minwage)
fit.minwage1</code></pre>
<pre><code>## 
## Call:
## lm(formula = fullPropAfter ~ NJ + fullPropBefore + wageBefore + 
##     chain, data = minwage)
## 
## Coefficients:
##    (Intercept)              NJ  fullPropBefore      wageBefore  
##       -0.11563         0.05422         0.16879         0.08133  
##       chainkfc       chainroys     chainwendys  
##       -0.03517        -0.09076        -0.10451</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">predict</span>(fit.minwage, <span class="dt">newdata =</span> minwage[<span class="dv">1</span>, ])</code></pre>
<pre><code>##         1 
## 0.2709367</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">predict</span>(fit.minwage1, <span class="dt">newdata =</span> minwage[<span class="dv">1</span>, ])</code></pre>
<pre><code>##         1 
## 0.2709367</code></pre>
</div>
<div id="section-7-3-2-unbiasedness-of-estimated-coefficients" class="section level3">
<h3 class="hasAnchor">
<a href="#section-7-3-2-unbiasedness-of-estimated-coefficients" class="anchor"></a>Section 7.3.2: Unbiasedness of Estimated Coefficients</h3>
</div>
<div id="section-7-3-3-standard-errors-of-estimated-coefficients" class="section level3">
<h3 class="hasAnchor">
<a href="#section-7-3-3-standard-errors-of-estimated-coefficients" class="anchor"></a>Section 7.3.3: Standard Errors of Estimated Coefficients</h3>
</div>
<div id="section-7-3-4-inference-about-coefficients" class="section level3">
<h3 class="hasAnchor">
<a href="#section-7-3-4-inference-about-coefficients" class="anchor"></a>Section 7.3.4: Inference About Coefficients</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(women, <span class="dt">package =</span> <span class="st">"qss"</span>)
fit.women &lt;-<span class="st"> </span><span class="kw">lm</span>(water ~<span class="st"> </span>reserved, <span class="dt">data =</span> women)
<span class="kw">summary</span>(fit.women)</code></pre>
<pre><code>## 
## Call:
## lm(formula = water ~ reserved, data = women)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -23.991 -14.738  -7.865   2.262 316.009 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   14.738      2.286   6.446 4.22e-10 ***
## reserved       9.252      3.948   2.344   0.0197 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 33.45 on 320 degrees of freedom
## Multiple R-squared:  0.01688,    Adjusted R-squared:  0.0138 
## F-statistic: 5.493 on 1 and 320 DF,  p-value: 0.0197</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">confint</span>(fit.women) <span class="co"># 95% confidence intervals</span></code></pre>
<pre><code>##                 2.5 %   97.5 %
## (Intercept) 10.240240 19.23640
## reserved     1.485608 17.01924</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(fit.minwage)</code></pre>
<pre><code>## 
## Call:
## lm(formula = fullPropAfter ~ -1 + NJ + fullPropBefore + wageBefore + 
##     chain, data = minwage)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.48617 -0.18135 -0.02809  0.15127  0.75091 
## 
## Coefficients:
##                 Estimate Std. Error t value Pr(&gt;|t|)   
## NJ               0.05422    0.03321   1.633  0.10343   
## fullPropBefore   0.16879    0.05662   2.981  0.00307 **
## wageBefore       0.08133    0.03892   2.090  0.03737 * 
## chainburgerking -0.11563    0.17888  -0.646  0.51844   
## chainkfc        -0.15080    0.18310  -0.824  0.41074   
## chainroys       -0.20639    0.18671  -1.105  0.26974   
## chainwendys     -0.22013    0.18840  -1.168  0.24343   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.2438 on 351 degrees of freedom
## Multiple R-squared:  0.6349, Adjusted R-squared:  0.6277 
## F-statistic: 87.21 on 7 and 351 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## confidence interval just for the `NJ' variable
<span class="kw">confint</span>(fit.minwage)[<span class="st">"NJ"</span>, ]</code></pre>
<pre><code>##       2.5 %      97.5 % 
## -0.01109295  0.11953297</code></pre>
</div>
<div id="section-7-3-5-inference-about-predictions" class="section level3">
<h3 class="hasAnchor">
<a href="#section-7-3-5-inference-about-predictions" class="anchor"></a>Section 7.3.5: Inference About Predictions</h3>
<pre class="sourceCode r"><code class="sourceCode r">## load the data and subset them into two parties
<span class="kw">data</span>(<span class="st">"MPs"</span>, <span class="dt">package =</span> <span class="st">"qss"</span>)
MPs.labour &lt;-<span class="st"> </span><span class="kw">subset</span>(MPs, <span class="dt">subset =</span> (party ==<span class="st"> "labour"</span>))
MPs.tory &lt;-<span class="st"> </span><span class="kw">subset</span>(MPs, <span class="dt">subset =</span> (party ==<span class="st"> "tory"</span>))

## two regressions for labour: negative and positive margin
labour.fit1 &lt;-<span class="st"> </span><span class="kw">lm</span>(ln.net ~<span class="st"> </span>margin,
                  <span class="dt">data =</span> MPs.labour[MPs.labour$margin &lt;<span class="st"> </span><span class="dv">0</span>, ])
labour.fit2 &lt;-<span class="st"> </span><span class="kw">lm</span>(ln.net ~<span class="st"> </span>margin,
                  <span class="dt">data =</span> MPs.labour[MPs.labour$margin &gt;<span class="st"> </span><span class="dv">0</span>, ])

## two regressions for tory: negative and positive margin
tory.fit1 &lt;-<span class="st"> </span><span class="kw">lm</span>(ln.net ~<span class="st"> </span>margin, <span class="dt">data =</span> MPs.tory[MPs.tory$margin &lt;<span class="st"> </span><span class="dv">0</span>, ])
tory.fit2 &lt;-<span class="st"> </span><span class="kw">lm</span>(ln.net ~<span class="st"> </span>margin, <span class="dt">data =</span> MPs.tory[MPs.tory$margin &gt;<span class="st"> </span><span class="dv">0</span>, ])

## tory party: prediction at the threshold
tory.y0 &lt;-<span class="st"> </span><span class="kw">predict</span>(tory.fit1, <span class="dt">interval =</span> <span class="st">"confidence"</span>,
                   <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">margin =</span> <span class="dv">0</span>))
tory.y0</code></pre>
<pre><code>##        fit      lwr      upr
## 1 12.53812 12.11402 12.96221</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">tory.y1 &lt;-<span class="st"> </span><span class="kw">predict</span>(tory.fit2, <span class="dt">interval =</span> <span class="st">"confidence"</span>,
                   <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">margin =</span> <span class="dv">0</span>))
tory.y1</code></pre>
<pre><code>##       fit      lwr      upr
## 1 13.1878 12.80691 13.56869</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## range of predictors; min to 0 and 0 to max
y1.range &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="kw">min</span>(MPs.tory$margin), <span class="dt">by =</span> -<span class="fl">0.01</span>)
y2.range &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="kw">max</span>(MPs.tory$margin), <span class="dt">by =</span> <span class="fl">0.01</span>)

## prediction using all the values
tory.y0 &lt;-<span class="st"> </span><span class="kw">predict</span>(tory.fit1, <span class="dt">interval =</span> <span class="st">"confidence"</span>,
                   <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">margin =</span> y1.range))
tory.y1 &lt;-<span class="st"> </span><span class="kw">predict</span>(tory.fit2, <span class="dt">interval =</span> <span class="st">"confidence"</span>,
                   <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">margin =</span> y2.range))

<span class="kw">par</span>(<span class="dt">cex =</span> <span class="fl">1.5</span>)
## plotting the first regression with losers
<span class="kw">plot</span>(y1.range, tory.y0[, <span class="st">"fit"</span>], <span class="dt">type =</span> <span class="st">"l"</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(-<span class="fl">0.5</span>, <span class="fl">0.5</span>),
     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">15</span>), <span class="dt">xlab =</span> <span class="st">"Margin of victory"</span>, <span class="dt">ylab =</span> <span class="st">"log net wealth"</span>)
<span class="kw">abline</span>(<span class="dt">v =</span> <span class="dv">0</span>, <span class="dt">lty =</span> <span class="st">"dotted"</span>)
<span class="kw">lines</span>(y1.range, tory.y0[, <span class="st">"lwr"</span>], <span class="dt">lty =</span> <span class="st">"dashed"</span>) <span class="co"># lower CI</span>
<span class="kw">lines</span>(y1.range, tory.y0[, <span class="st">"upr"</span>], <span class="dt">lty =</span> <span class="st">"dashed"</span>) <span class="co"># upper CI</span>

## plotting the second regression with winners
<span class="kw">lines</span>(y2.range, tory.y1[, <span class="st">"fit"</span>], <span class="dt">lty =</span> <span class="st">"solid"</span>)  <span class="co"># point estimates</span>
<span class="kw">lines</span>(y2.range, tory.y1[, <span class="st">"lwr"</span>], <span class="dt">lty =</span> <span class="st">"dashed"</span>) <span class="co"># lower CI</span>
<span class="kw">lines</span>(y2.range, tory.y1[, <span class="st">"upr"</span>], <span class="dt">lty =</span> <span class="st">"dashed"</span>) <span class="co"># upper CI</span></code></pre>
<p><img src="uncertainty_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<pre class="sourceCode r"><code class="sourceCode r">## re-compute the predicted value and return standard errors
tory.y0 &lt;-<span class="st"> </span><span class="kw">predict</span>(tory.fit1, <span class="dt">interval =</span> <span class="st">"confidence"</span>, <span class="dt">se.fit =</span> <span class="ot">TRUE</span>,
                   <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">margin =</span> <span class="dv">0</span>))
tory.y0</code></pre>
<pre><code>## $fit
##        fit      lwr      upr
## 1 12.53812 12.11402 12.96221
## 
## $se.fit
## [1] 0.2141793
## 
## $df
## [1] 119
## 
## $residual.scale
## [1] 1.434283</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">tory.y1 &lt;-<span class="st"> </span><span class="kw">predict</span>(tory.fit2, <span class="dt">interval =</span> <span class="st">"confidence"</span>, <span class="dt">se.fit =</span> <span class="ot">TRUE</span>,
                   <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">margin =</span> <span class="dv">0</span>))

## s.e. of the intercept is the same as s.e. of the predicted value
<span class="kw">summary</span>(tory.fit1)</code></pre>
<pre><code>## 
## Call:
## lm(formula = ln.net ~ margin, data = MPs.tory[MPs.tory$margin &lt; 
##     0, ])
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.3195 -0.4721 -0.0349  0.6629  3.5798 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  12.5381     0.2142  58.540   &lt;2e-16 ***
## margin        1.4911     1.2914   1.155    0.251    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 1.434 on 119 degrees of freedom
## Multiple R-squared:  0.01108,    Adjusted R-squared:  0.002769 
## F-statistic: 1.333 on 1 and 119 DF,  p-value: 0.2506</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## standard error
se.diff &lt;-<span class="st"> </span><span class="kw">sqrt</span>(tory.y0$se.fit^<span class="dv">2</span> +<span class="st"> </span>tory.y1$se.fit^<span class="dv">2</span>)
se.diff</code></pre>
<pre><code>## [1] 0.2876281</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## point estimate
diff.est &lt;-<span class="st"> </span>tory.y1$fit[<span class="dv">1</span>, <span class="st">"fit"</span>] -<span class="st"> </span>tory.y0$fit[<span class="dv">1</span>, <span class="st">"fit"</span>]
diff.est</code></pre>
<pre><code>## [1] 0.6496861</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## confidence interval
CI &lt;-<span class="st"> </span><span class="kw">c</span>(diff.est -<span class="st"> </span>se.diff *<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.975</span>), diff.est +<span class="st"> </span>se.diff *<span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.975</span>))
CI</code></pre>
<pre><code>## [1] 0.0859455 1.2134268</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">## hypothesis test
z.score &lt;-<span class="st"> </span>diff.est /<span class="st"> </span>se.diff
p.value &lt;-<span class="st"> </span><span class="dv">2</span> *<span class="st"> </span><span class="kw">pnorm</span>(<span class="kw">abs</span>(z.score), <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>) <span class="co"># two-sided p-value</span>
p.value</code></pre>
<pre><code>## [1] 0.02389759</code></pre>
</div>
</div>
<div id="section-7-4-summary" class="section level2">
<h2 class="hasAnchor">
<a href="#section-7-4-summary" class="anchor"></a>Section 7.4: Summary</h2>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#chapter-7-uncertainty">Chapter 7: Uncertainty</a><ul class="nav nav-pills nav-stacked">
<li><a href="#section-7-1-estimation">Section 7.1: Estimation</a></li>
      <li><a href="#section-7-2-hypothesis-testing">Section 7.2: Hypothesis Testing</a></li>
      <li><a href="#section-7-3-linear-regression-model-with-uncertainty">Section 7.3: Linear Regression Model with Uncertainty</a></li>
      <li><a href="#section-7-4-summary">Section 7.4: Summary</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Jeffey Arnold, Kosuke Imai, Tyler Simko.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
